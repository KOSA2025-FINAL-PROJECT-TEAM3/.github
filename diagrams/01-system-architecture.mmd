graph TB
%% ===== FRONTEND =====
subgraph FRONTEND["ğŸ–¥ï¸ Frontend Layer"]
    A[React Web App]
    A1[Auth Components]
    A2[Family Components]
    A3[Medication Components]
    A4[Diet Components]
    A5[Dashboard]

    A --> A1 & A2 & A3 & A4 & A5
end

%% ===== CLOUD INFRA =====
subgraph CLOUD["â˜ï¸ Spring Cloud Infrastructure"]
    GW[API Gateway<br/>Spring Cloud Gateway]
    EUR[Eureka Server<br/>Service Discovery]
    CFG[Config Server<br/>Central Config]
end

%% ===== MICROSERVICES =====
subgraph MS["ğŸ§© Microservices"]
    AUTH[Auth Service<br/>ì¸ì¦/ì¸ê°€/JWT]
    MED[Medication Service<br/>ì•½ ê´€ë¦¬]
    FAM[Family Service<br/>ê°€ì¡± ë„¤íŠ¸ì›Œí¬]
    DIET[Diet Service<br/>ì‹ë‹¨ ê´€ë¦¬]
    NOTI[Notification Service<br/>ì•Œë¦¼]
    OCR[OCR Service<br/>ì•½ë´‰ì§€ ì¸ì‹]
end

%% ===== REALTIME =====
subgraph REALTIME["âš¡ Real-time Sync Layer"]
    WS[WebSocket/STOMP<br/>ì‹¤ì‹œê°„ ë©”ì‹œì§•]
    MSG[Message Broker<br/>Redis PubSub / RabbitMQ]
    WS --> MSG
end

%% ===== EVENT PROCESSING =====
subgraph EVENT["ğŸŒ€ Event Processing (Kafka)"]
    K[Apache Kafka]
    K1[Medication Events]
    K2[Notification Events]
    K3[Family Events]
    K4[Sync Events]
    K --> K1 & K2 & K3 & K4
end

%% ===== DATABASE =====
subgraph DBLAYER["ğŸ—„ï¸ Database Layer"]
    DB[(MySQL 8.0<br/>Main DB)]
    R[(Redis<br/>Cache / Session)]
end

%% ===== EXTERNAL =====
subgraph EXT["ğŸŒ External Services"]
    E1[ì‹ì•½ì²˜ API<br/>ì˜ì•½í’ˆì•ˆì „ë‚˜ë¼]
    E2[Google Vision OCR<br/>ì•½ë´‰ì§€ ì¸ì‹]
    E3[ì¹´ì¹´ì˜¤í†¡ API<br/>ì•Œë¦¼í†¡]
    E4[n8n Workflow<br/>ìë™í™”]
end

%% ===== CONNECTIONS =====
A -->|HTTP/REST| GW
A -->|WebSocket| WS

GW --> EUR & CFG
GW --> AUTH & MED & FAM & DIET & NOTI & OCR

EUR -.->|Service Register| AUTH & MED & FAM & DIET & NOTI & OCR
CFG -.->|Load Config| AUTH & MED & FAM & DIET & NOTI & OCR

%% DB & CACHE
AUTH --> DB & R
MED --> DB & R
FAM --> DB & R
DIET --> DB
NOTI --> DB
OCR --> DB

%% KAFKA
MED -->|Publish| K
FAM -->|Publish| K
DIET -->|Publish| K
NOTI -->|Consume| K
K -->|Event Stream| WS

%% REALTIME
WS -->|Session| R
MED -->|Push Events| WS
FAM -->|Push Events| WS
DIET -->|Push Events| WS

%% EXTERNAL
MED --> E1
OCR --> E2
NOTI --> E3
K --> E4

%% FEIGN CLIENTS
MED -.->|Feign| FAM
DIET -.->|Feign| MED
NOTI -.->|Feign| FAM

%% ===== STYLING =====
style A fill:#61dafb,stroke:#333,stroke-width:2px,font-weight:bold
style GW fill:#68bc00,stroke:#333,stroke-width:3px
style EUR fill:#68bc00,stroke:#333,stroke-width:2px
style CFG fill:#68bc00,stroke:#333,stroke-width:2px

style AUTH fill:#6db33f,stroke:#333,stroke-width:2px
style MED fill:#6db33f,stroke:#333,stroke-width:2px
style FAM fill:#6db33f,stroke:#333,stroke-width:2px
style DIET fill:#6db33f,stroke:#333,stroke-width:2px
style NOTI fill:#6db33f,stroke:#333,stroke-width:2px
style OCR fill:#6db33f,stroke:#333,stroke-width:2px

style WS fill:#ff6b35,stroke:#333,stroke-width:3px,color:#fff
style MSG fill:#ff6b35,stroke:#333,stroke-width:2px,color:#fff

style K fill:#231f20,stroke:#fff,stroke-width:2px,color:#fff
style DB fill:#4479a1,stroke:#333,stroke-width:2px,color:#fff
style R fill:#dc382d,stroke:#333,stroke-width:2px,color:#fff

style E1 fill:#b0b0b0,stroke:#333,stroke-width:2px
style E2 fill:#b0b0b0,stroke:#333,stroke-width:2px
style E3 fill:#b0b0b0,stroke:#333,stroke-width:2px
style E4 fill:#b0b0b0,stroke:#333,stroke-width:2px
